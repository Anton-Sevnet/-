var P=(s,e,r)=>{if(!e.has(s))throw TypeError("Cannot "+r)};var S=(s,e,r)=>(P(s,e,"read from private field"),r?r.call(s):e.get(s)),_=(s,e,r)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,r)},O=(s,e,r,n)=>(P(s,e,"write to private field"),n?n.call(s,r):e.set(s,r),r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const t of o)if(t.type==="childList")for(const a of t.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const t={};return o.integrity&&(t.integrity=o.integrity),o.referrerPolicy&&(t.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?t.credentials="include":o.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function n(o){if(o.ep)return;o.ep=!0;const t=r(o);fetch(o.href,t)}})();const B="modulepreload",v=function(s){return"/"+s},L={},w=function(e,r,n){if(!r||r.length===0)return e();const o=document.getElementsByTagName("link");return Promise.all(r.map(t=>{if(t=v(t),t in L)return;L[t]=!0;const a=t.endsWith(".css"),l=a?'[rel="stylesheet"]':"";if(!!n)for(let d=o.length-1;d>=0;d--){const u=o[d];if(u.href===t&&(!a||u.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${t}"]${l}`))return;const i=document.createElement("link");if(i.rel=a?"stylesheet":B,a||(i.as="script",i.crossOrigin=""),i.href=t,document.head.appendChild(i),a)return new Promise((d,u)=>{i.addEventListener("load",d),i.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${t}`)))})})).then(()=>e())};const p={Button:{CREATE_TASK:"btnCreateTask",CLOSE_POPUP_CREATE_TASK:"btnCloseCreateTaskPopup",POPUP_CREATE_TASK_CONFIRM:"btnConfirmTaskPopup"},Template:{TASK:"templateTask",Task:{TITLE:"templateTaskTitle",BTN_EDIT:"btnEdit",BTN_DELETE:"btnDelete"}},Popup:{CREATE_TASK:"popupContainer",CreateTask:{TITLE:"title"}}},I=s=>new Promise((e,r)=>{setTimeout(e,s)});class k{static fromJSON(e){return new k(e.id,e.title,e.date,e.tags)}constructor(e,r,n,o){this.id=e,this.title=r,this.date=n,this.tags=o}}var f;class b{constructor(e){_(this,f,void 0);O(this,f,e)}async retrieveTasks(){S(this,f).tasks=await fetch("http://localhost:3000/tasks").then(e=>e.ok&&e.json()).then(e=>e&&e instanceof Array?(console.log("json",e),e.map(r=>k.fromJSON(r))):(window.alert("Problem with data parsing, try refresh later"),[])).catch(e=>(window.alert("Server error:"+e.toString()),[]))}createTask(e,r,n){console.log("> TasksController -> createTask"),fetch("http://localhost:3000/tasks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e,date:r,tags:n})})}}f=new WeakMap;const R="tasks",D=["Web","Update","Design","Content"],E=s=>document.getElementById(s),U=(s,e)=>s.querySelector(`[data-id="${e}"]`),h=E(p.Template.TASK),m=h.parentNode,A=new TasksModel,N=new b(A);h.removeAttribute("id");h.remove();function C(s){const e=h.cloneNode(!0);return e.dataset.id=s.id,U(e,p.Template.Task.TITLE).innerText=s.title,m.prepend(e),e}async function K(){A.addUpdateCallBack(n=>{console.log("-> addUpdateCallBack: "+n),m.innerHTML="",n.forEach(o=>C(o))}),N.retrieveTasks();const s={[p.Button.CREATE_TASK]:()=>{e(null,"Create task","Create",(n,o,t)=>{console.log("> Create task -> On Confirm");const a=`task_${Date.now()}`,l=new k(a,n,o,t);C(l),tasks.push(l),r()})},[p.Template.Task.BTN_DELETE]:(n,o)=>{e(n,"Confirm delete task?","Delete",(t,a,l)=>{console.log("> Delete task -> On Confirm",{taskTitle:t,taskDate:a,taskTag:l});const c=tasks.indexOf(n);tasks.splice(c,1),m.removeChild(o),r()})},[p.Template.Task.BTN_EDIT]:(n,o)=>{e(n,"Update task","Update",(t,a,l)=>{console.log("> Update task -> On Confirm",{taskTitle:t,taskDate:a,taskTag:l}),n.title=t;const c=C(n);m.replaceChild(c,o),r()})}};m.onclick=n=>{n.stopPropagation(),console.log("domTaskColumn",n.target);const o=n.target,t=o.dataset.btn;if(!t||![p.Template.Task.BTN_EDIT,p.Template.Task.BTN_DELETE].includes(t))return;let c,i=o;do i=i.parentNode,c=i.dataset.id;while(!c);const d=tasks.find(T=>T.id===c);console.log("> taskVO:",d);const u=s[t];u&&u(d,i)},E(p.Button.CREATE_TASK).onclick=()=>{console.log("> domPopupCreateTask.classList"),e(null,"Create task","Create",(n,o,t)=>{console.log("> Create task -> On Confirm"),N.createTask(n,o,t)})};async function e(n,o,t,a){const l=E(p.Popup.CONTAINER),c=l.querySelector(".spinner");l.classList.remove("hidden");const i=()=>{document.onkeyup=null,l.children[0].remove(),l.append(c),l.classList.add("hidden")},d=(await w(()=>import("./TaskPopup-fc0392fb.js"),[])).default,u=new d(o,D,t,(T,g,y)=>{console.log("Main -> renderTaskPopup: confirmCallback",{taskTitle:T,taskDate:g,taskTags:y}),a(T,g,y),i()},i);n&&(u.taskTitle=n.title),I(1e3).then(()=>{console.log("render 1"),c.remove(),document.onkeyup=T=>{T.key==="Escape"&&i()},l.append(u.render())}),console.log("render 0")}function r(){localStorage.setItem(R,JSON.stringify(tasks))}}K();
